name: publish
on:
  push:
    tags:
    - 'v*'  # è¿™æ®µçš„æ„æ€æ˜¯ä»…åœ¨å‡ºç°åä¸º v å­—ç¬¦å¼€å¤´çš„tagæ—¶ï¼Œè§¦å‘æ­¤ä»»åŠ¡ï¼Œå¦‚v1.2.1
jobs:
  publish:
    # needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2
      - name: Setup-node
        uses: actions/setup-node@v2
        with:
          node-version: '14.x'
          registry-url: 'https://registry.npmjs.org'
      - name: Install and Build ğŸ”§
        run: |
          npm install yarn
          yarn
          yarn build
      - name: Deploy ğŸš€
        run: npm publish
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
  github-release: # è®¾ç½®è‡ªåŠ¨ç”ŸæˆGithub Release
    needs: publish
    runs-on: ubuntu-latest
    steps:
      - name:  Checkout ğŸ›ï¸
        uses: actions/checkout@v2
      - name:
        uses: actions/setup-node@v1
        with:
          node-version: '14.x'
          registry-url: https://registry.npmjs.org/
      - name: Install yarn
        run: npm install yarn
      - name: Install github-release-from-changelog
        run: yarn add github-release-from-changelog -g
        run: github-release-from-changelog
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°åä¸ºGITHUB_TOKENçš„å¯†é’¥ï¼Œç”¨äºè®¿é—®Githubç›¸å…³çš„APIï¼Œä¸è¿‡è¿™ä¸ªç§é’¥æ˜¯Github Actionsé»˜è®¤æä¾›çš„ï¼Œä¸éœ€è¦é¢å¤–è®¾ç½®ã€‚

